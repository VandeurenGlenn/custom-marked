{"version":3,"file":"custom-marked.js","sources":["../src/custom-marked.js"],"sourcesContent":["Backed(class CustomMarked extends HTMLElement {\r\n  static get properties() {\r\n    return {\r\n      /**\r\n       * The source that should be converted into markdown\r\n       */\r\n       src: {\r\n         observer: 'unindent',\r\n         value: null\r\n       },\r\n      /**\r\n       * The markdown source that should be rendered by this element.\r\n       */\r\n      markdown: {\r\n        observer: 'render',\r\n        type: String,\r\n        value: null\r\n      },\r\n\r\n      /**\r\n       * True when marked is ready.\r\n       */\r\n      markedReady: {\r\n        observer: 'render',\r\n        type: Boolean,\r\n        value: null\r\n      },\r\n\r\n      /**\r\n       * Conform to obscure parts of markdown.pl as much as possible. Don't fix any of the original markdown bugs or poor behavior.\r\n       */\r\n      pedantic: {\r\n        observer: 'render',\r\n        type: Boolean,\r\n        value: false\r\n      },\r\n      /**\r\n       * Function used to customize a renderer based on the [API specified in the Marked\r\n       * library](https://github.com/chjj/marked#overriding-renderer-methods).\r\n       * It takes one argument: a marked renderer object, which is mutated by the function.\r\n       */\r\n      renderer: {\r\n        observer: 'render',\r\n        type: Function,\r\n        value: null\r\n      },\r\n      /**\r\n       * Sanitize the output. Ignore any HTML that has been input.\r\n       */\r\n      sanitize: {\r\n        observer: 'render',\r\n        type: Boolean,\r\n        value: false\r\n      },\r\n      /**\r\n       * Use \"smart\" typographic punctuation for things like quotes and dashes.\r\n       */\r\n      smartypants: {\r\n        observer: 'render',\r\n        type: Boolean,\r\n        value: false\r\n      },\r\n      /**\r\n       * Callback function invoked by Marked after HTML has been rendered.\r\n       * It must take two arguments: err and text and must return the resulting text.\r\n       */\r\n      callback: {\r\n        observer: 'render',\r\n        type: Function,\r\n        value: null\r\n      }\r\n    }\r\n  }\r\n  static get observers() {\r\n\r\n  }\r\n  constructor() {\r\n    super();\r\n    this._highlight = this._highlight.bind(this)\r\n  }\r\n\r\n  connectedCallback() {\r\n    const promises = [\r\n      this.loadScript('../bower_components/prism/prism.js'),\r\n      this.loadScript('../bower_components/marked/marked.min.js')\r\n    ]\r\n    Promise.all(promises).then(() => {\r\n      this.markedReady = true;\r\n      this.src = this.getAttribute('src');\r\n    });\r\n  }\r\n\r\n  render(change) {\r\n    console.log(change);\r\n    if (this.markedReady && this.markdown) {\r\n      let renderer = new marked.Renderer();\r\n      if (this.renderer) {\r\n        this.renderer(renderer);\r\n      }\r\n      let opts = {\r\n        renderer: renderer,\r\n        highlight: this._highlight.bind(this),\r\n        sanitize: this.sanitize,\r\n        pedantic: this.pedantic,\r\n        smartypants: this.smartypants\r\n      };\r\n      let snippet = this.markdown;\r\n      snippet = snippet.replace(/=\"\"/g, '');\r\n      this._markdown = '```\\n' + snippet + '\\n' + '```';\r\n      this.innerHTML = marked(this._markdown, opts, this.callback);\r\n    }\r\n  }\r\n\r\n  _highlight(code, lang) {\r\n    let event = this.fireEvent('syntax-highlight', {code: code, lang: lang});\r\n    return Prism.highlight(code, this._detectLang(code, lang));\r\n  }\r\n\r\n  unindent(change) {\r\n    if (change.value) {\r\n      this.markdown = this._unindent(change.value);\r\n    }\r\n  }\r\n\r\n  _unindent(text) {\r\n     if (!text) return text;\r\n     let lines  = text.replace(/\\t/g, '  ').split('\\n');\r\n     let indent = lines.reduce((prev, line) => {\r\n       if (/^\\s*$/.test(line)) return prev;  // Completely ignore blank lines.\r\n       let lineIndent = line.match(/^(\\s*)/)[0].length;\r\n       if (prev === null) return lineIndent;\r\n       return lineIndent < prev ? lineIndent : prev;\r\n     }, null);\r\n     return lines.map((l) => { return l.substr(indent); }).join('\\n');\r\n   }\r\n\r\n   /**\r\n    * Picks a Prism formatter based on the `lang` hint and `code`.\r\n    *\r\n    * @param {string} code The source being highlighted.\r\n    * @param {string=} lang A language hint (e.g. ````LANG`).\r\n    * @return {!prism.Lang}\r\n    */\r\n   _detectLang(code, lang) {\r\n     if (!lang) {\r\n       // Stupid simple detection if we have no lang, courtesy of:\r\n       // https://github.com/robdodson/mark-down/blob/ac2eaa/mark-down.html#L93-101\r\n       return code.match(/^\\s*</) ? Prism.languages.markup : Prism.languages.javascript;\r\n     }\r\n     if (this.languages[lang]) {\r\n       return this.languages[lang];\r\n     } else if (Prism.languages[lang]) {\r\n       return Prism.languages[lang];\r\n     }\r\n     switch (lang.substr(0, 2)) {\r\n       case 'js':\r\n       case 'es':\r\n         return Prism.languages.javascript;\r\n       case 'c':\r\n         return Prism.languages.clike;\r\n       default:\r\n         // The assumption is that you're mostly documenting HTML when in HTML.\r\n         return Prism.languages.markup;\r\n     }\r\n   }\r\n\r\n});\r\n"],"names":[],"mappings":"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"}